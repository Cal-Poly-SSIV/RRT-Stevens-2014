
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML is auto-generated from an M-file.
To make changes, update the M-file and republish this document.
      --><title>MPC Code Generation with Real-Time Workshop&reg;</title><meta name="generator" content="MATLAB 7.10"><meta name="date" content="2010-01-05"><meta name="m-file" content="mpcrtwdemo"><link rel="stylesheet" type="text/css" href="../../../matlab/demos/private/style.css"></head><body><div class="header"><div class="left"><a href="matlab:edit mpcrtwdemo">Open mpcrtwdemo.m in the Editor</a></div><div class="right"><a href="matlab:echodemo mpcrtwdemo">Run in the Command Window</a></div></div><div class="content"><h1>MPC Code Generation with Real-Time Workshop&reg;</h1><!--introduction--><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#2">Plant Model and MPC Controller Setup</a></li><li><a href="#5">Simulation Using Simulink&reg;.</a></li></ul></div><p>This demonstration shows how to use Real-Time Workshop&reg; to generate real-time code from a Simulink&reg; diagram containing MPC controllers. We consider here a single-input single-output system tracking of a sinusoid under output constraints.</p><h2>Plant Model and MPC Controller Setup<a name="2"></a></h2><p>To run this demo, Simulink&reg; and Real-Time Workshop&reg; are required.</p><pre class="codeinput"><span class="keyword">if</span> ~mpcchecktoolboxinstalled(<span class="string">'simulink'</span>)
    disp(<span class="string">'Simulink(R) is required to run this demo.'</span>)
    <span class="keyword">return</span>
<span class="keyword">end</span>
<span class="keyword">if</span> ~mpcchecktoolboxinstalled(<span class="string">'rtw'</span>)
    disp(<span class="string">'Real-Time Workshop(R) is required to run this demo.'</span>);
    <span class="keyword">return</span>
<span class="keyword">end</span>
</pre><p>We start defining the plant to be controlled.</p><pre class="codeinput">N1=[3 1];
D1=[1 2*.3 1];
[A,B,C,D]=tf2ss(N1,D1);
x0=[0 0]';
</pre><p>Now, setup an MPC controller object.</p><pre class="codeinput">Ts=.2;     <span class="comment">%Sampling time</span>

<span class="comment">% Input and output constraints</span>
MV=struct(<span class="string">'Min'</span>,-Inf,<span class="string">'Max'</span>,Inf,<span class="string">'RateMin'</span>,-20,<span class="string">'RateMax'</span>,20);
OV=struct(<span class="string">'Min'</span>,-0.5,<span class="string">'Max'</span>,0.5);

p=40;
m=3;

mpccon=mpc(ss(A,B,C,D),Ts,p,m,[],MV,OV);
</pre><pre class="codeoutput">--&gt;The "Weights.ManipulatedVariables" property of "mpc" object is empty. Assuming default 0.00000.
--&gt;The "Weights.ManipulatedVariablesRate" property of "mpc" object is empty. Assuming default 0.10000.
--&gt;The "Weights.OutputVariables" property of "mpc" object is empty. Assuming default 1.00000.
</pre><h2>Simulation Using Simulink&reg;.<a name="5"></a></h2><pre class="codeinput">Tstop=10;  <span class="comment">%Simulation time</span>

open_system(<span class="string">'mpc_rtwdemo'</span>)
sim(<span class="string">'mpc_rtwdemo'</span>,Tstop)
</pre><pre class="codeoutput">--&gt;Converting model to discrete time.
--&gt;Integrated white noise added on measured output channel #1.
--&gt;The "Model.Noise" property of the "mpc" object is empty. Assuming white noise on each measured output channel.
</pre><img vspace="5" hspace="5" src="mpcrtwdemo_01.png" alt=""> <img vspace="5" hspace="5" src="mpcrtwdemo_02.png" alt=""> <img vspace="5" hspace="5" src="mpcrtwdemo_03.png" alt=""> <p>Call Real-Time Workshop&reg; to compile the Simulink&reg; diagram into an executable Change directory to a temp directory so that you have write-permission to generate the relevant target files and the executable.</p><pre class="codeinput">close_system(<span class="string">'mpc_rtwdemo/Inputs'</span>)
close_system(<span class="string">'mpc_rtwdemo/Outputs//References'</span>)
cwd = pwd;
cd(tempdir)
<span class="keyword">try</span>
    h = waitbar(0.3,<span class="string">'Compiling... Please wait until it finishes.'</span>);
    rtwbuild(<span class="string">'mpc_rtwdemo'</span>);
    waitbar(0.8,h);
    close(h);
<span class="keyword">catch</span> ME
    close(h);
    disp(ME.message);
    <span class="keyword">return</span>
<span class="keyword">end</span>
</pre><pre class="codeoutput">Undefined function or method 'getPathName' for input arguments of type 'cell'.
</pre><p>Run the executable, called mpc_rtwdemo.exe:</p><p>If the build finished successfully and if you are able to run the executable (status=0), you should have a data file named mpc_rtwdemo.mat in your temporary directory. You can load this file and compare the data with that generated by simulating the model mpc_rtwdemo.mdl.</p><pre class="codeinput">status = system(<span class="string">'mpc_rtwdemo'</span>);
cd(cwd)
</pre><pre class="codeinput">bdclose(<span class="string">'mpc_rtwdemo'</span>)
</pre><p class="footer">Copyright 1990-2009 The MathWorks, Inc.<br>
          Published with MATLAB&reg; 7.10</p><p class="footer" id="trademarks">MATLAB and Simulink are registered trademarks of The MathWorks, Inc.  Please see <a href="http://www.mathworks.com/trademarks">www.mathworks.com/trademarks</a> for a list of other trademarks owned by The MathWorks, Inc.  Other product or brand names are trademarks or registered trademarks of their respective owners.</p></div><!--
##### SOURCE BEGIN #####
%% MPC Code Generation with Real-Time Workshop(R)

%%
% This demonstration shows how to use Real-Time Workshop(R) to generate
% real-time code from a Simulink(R) diagram containing MPC controllers. We
% consider here a single-input single-output system tracking of a sinusoid
% under output constraints. 
%
% Copyright 1990-2009 The MathWorks, Inc.
% $Revision: 1.1.4.13 $  $Date: 2009/09/21 00:04:29 $   


%% Plant Model and MPC Controller Setup
% To run this demo, Simulink(R) and Real-Time Workshop(R) are required.
if ~mpcchecktoolboxinstalled('simulink')
    disp('Simulink(R) is required to run this demo.')
    return
end
if ~mpcchecktoolboxinstalled('rtw')
    disp('Real-Time Workshop(R) is required to run this demo.');
    return
end

%%
% We start defining the plant to be controlled.
N1=[3 1];
D1=[1 2*.3 1]; 
[A,B,C,D]=tf2ss(N1,D1);
x0=[0 0]';

%%
% Now, setup an MPC controller object.
Ts=.2;     %Sampling time

% Input and output constraints
MV=struct('Min',-Inf,'Max',Inf,'RateMin',-20,'RateMax',20);
OV=struct('Min',-0.5,'Max',0.5);

p=40;
m=3;

mpccon=mpc(ss(A,B,C,D),Ts,p,m,[],MV,OV);

%% Simulation Using Simulink(R).
Tstop=10;  %Simulation time

open_system('mpc_rtwdemo')
sim('mpc_rtwdemo',Tstop)

%%
% Call Real-Time Workshop(R) to compile the Simulink(R) diagram into an executable
% Change directory to a temp directory so that you have write-permission to
% generate the relevant target files and the executable.
close_system('mpc_rtwdemo/Inputs')
close_system('mpc_rtwdemo/Outputs//References')
cwd = pwd;
cd(tempdir)
try
    h = waitbar(0.3,'Compiling... Please wait until it finishes.');
    rtwbuild('mpc_rtwdemo');
    waitbar(0.8,h);
    close(h);
catch ME
    close(h);
    disp(ME.message);
    return
end

%%
% Run the executable, called mpc_rtwdemo.exe:
%
% If the build finished successfully and if you are able to run the
% executable (status=0), you should have a data file named mpc_rtwdemo.mat
% in your temporary directory. You can load this file and compare the data
% with that generated by simulating the model mpc_rtwdemo.mdl.
status = system('mpc_rtwdemo');
cd(cwd)

%%
bdclose('mpc_rtwdemo')
displayEndOfDemoMessage(mfilename)

##### SOURCE END #####
--></body></html>